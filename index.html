<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/26/hello-world/" class="article-date">
  <time datetime="2018-04-26T02:14:18.088Z" itemprop="datePublished">2018-04-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/26/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/04/26/hello-world/" data-id="cjh5rqynt000ct4ul8qg1o0ix" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-nginx-php-fpm" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/17/nginx-php-fpm/" class="article-date">
  <time datetime="2018-04-17T05:48:03.000Z" itemprop="datePublished">2018-04-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/17/nginx-php-fpm/">nginx php-fpm</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="通讯流程"><a href="#通讯流程" class="headerlink" title="通讯流程"></a>通讯流程</h2><ol>
<li>Nginx接收到浏览器发来的请求，判断是否是.php</li>
<li>Nginx提供了fastcgi模块来将http请求映射为fastcgi请求</li>
<li>通过fastcgi_param指令将Nginx的变量转成PHP可理解的变量：fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;</li>
<li>通过fastcgi_pass指定的监听地址（tcp socket或者Unix socket），将请求转发给PHP-FPM</li>
<li>PHP-FPM的master进程收的请求，将请求转发给worker进程进行处理，worker进程处理完成后返回结果</li>
<li>如果没有空余的worker进程则502，如果worker进程处理超时则504</li>
</ol>
<h2 id="CGI"><a href="#CGI" class="headerlink" title="CGI"></a>CGI</h2><pre><code>WebServer与后台语言（PHP/JAVA/PYTHON等）进行交互的协议，基于此协议，后台语言可以选任意选。
</code></pre><h2 id="FastCGI"><a href="#FastCGI" class="headerlink" title="FastCGI"></a>FastCGI</h2><pre><code>由于众所周知的缺点，CGI被FastCGI代替了
</code></pre><h2 id="FPM"><a href="#FPM" class="headerlink" title="FPM"></a>FPM</h2><pre><code>FastCGI Process Manager，它可以与任何实现了FastCGI协议的webserver进行通信
</code></pre><h2 id="PHP-FPM"><a href="#PHP-FPM" class="headerlink" title="PHP-FPM"></a>PHP-FPM</h2><pre><code>PHP语言的进程管理器，包含master和worker两种进程。master接受webserver的请求，分配给worker，worker进程中的PHP解释器执行PHP代码
</code></pre><h2 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h2><h3 id="fastcgi-param指令"><a href="#fastcgi-param指令" class="headerlink" title="fastcgi_param指令"></a>fastcgi_param指令</h3><ul>
<li>Nginx的fastcgi模块将http请求映射为fastcgi请求，fastcgi_param指令将Nginx的变量转换成PHP可以理解的变量</li>
<li>fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;</li>
<li>fastcgi_param QUERY_STRING $query_string;</li>
<li>fastcgi_param REMOTE_ADDR $remote_addr;</li>
<li>等等<h3 id="fastcgi-pass指令"><a href="#fastcgi-pass指令" class="headerlink" title="fastcgi_pass指令"></a>fastcgi_pass指令</h3></li>
<li>Nginx与PHP-FPM通讯方式有两种，TCP和UNIX两种套接字。</li>
<li>如果两者处于同一机器，建议使用UNIX，效率高</li>
<li>如果两者处于不同的机器，则只能使用TCP</li>
<li>fastcgi_pass unix:/var/run/php5-fpm.sock;  //UNIX</li>
<li>fastcgi_pass 127.0.0.1:9000;  //TCP</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/04/17/nginx-php-fpm/" data-id="cjh5rqyn80001t4ul8bp9iz91" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-memcache" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/16/memcache/" class="article-date">
  <time datetime="2018-04-16T08:23:41.000Z" itemprop="datePublished">2018-04-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/16/memcache/">memcache</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Slab-Allocator管理内存"><a href="#Slab-Allocator管理内存" class="headerlink" title="Slab Allocator管理内存"></a>Slab Allocator管理内存</h2><ol>
<li>以一个page为单位去申请内存，page默认大小为1M</li>
<li>将page分成不同大小的chunk，数据是存在chunk中的，chunk默认48字节</li>
<li>chunk *= factor，factor默认大小1.25</li>
<li>具有相同大小chunk的组称为slab class</li>
<li>PS：memcache申请的内存不会被释放；分配出去的page不会被回收或重新分配；空闲的chunk不会借给其他slab使用；一个chunk中多余的内存就闲置了</li>
</ol>
<h2 id="cluster"><a href="#cluster" class="headerlink" title="cluster"></a>cluster</h2><ol>
<li>一致性哈希环，构造长度0~2^32的整数环；</li>
<li>把节点的hash值放到环上</li>
<li>把key的hash值放到环上</li>
<li>按顺时针查找节点，把key存入</li>
</ol>
<h2 id="LRU的实现"><a href="#LRU的实现" class="headerlink" title="LRU的实现"></a>LRU的实现</h2><ol>
<li>链表（遍历太慢，O(N)）</li>
<li>双向链表+HashMap</li>
<li>Java中的LinkedHashMap</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">public class LRUCache &#123;</span><br><span class="line">    class Node &#123;</span><br><span class="line">        Node pre;</span><br><span class="line">        Node next;</span><br><span class="line">        Integer key;</span><br><span class="line">        Integer val;</span><br><span class="line">        Node(Integer k, Integer v) &#123;</span><br><span class="line">            key = k;</span><br><span class="line">            val = v;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Map&lt;Integer, Node&gt; map = new HashMap&lt;Integer, Node&gt;();</span><br><span class="line">    // The head (eldest) of the doubly linked list.</span><br><span class="line">    Node head;</span><br><span class="line">    // The tail (youngest) of the doubly linked list.</span><br><span class="line">    Node tail;</span><br><span class="line">    int cap;</span><br><span class="line">    public LRUCache(int capacity) &#123;</span><br><span class="line">        cap = capacity;</span><br><span class="line">        head = new Node(null, null);</span><br><span class="line">        tail = new Node(null, null);</span><br><span class="line">        head.next = tail;</span><br><span class="line">        tail.pre = head;</span><br><span class="line">    &#125;</span><br><span class="line">    public int get(int key) &#123;</span><br><span class="line">        Node n = map.get(key);</span><br><span class="line">        if(n!=null) &#123;</span><br><span class="line">            n.pre.next = n.next;</span><br><span class="line">            n.next.pre = n.pre;</span><br><span class="line">            appendTail(n);</span><br><span class="line">            return n.val;</span><br><span class="line">        &#125;</span><br><span class="line">        return -1;</span><br><span class="line">    &#125;</span><br><span class="line">    public void set(int key, int value) &#123;</span><br><span class="line">        Node n = map.get(key);</span><br><span class="line">        // existed</span><br><span class="line">        if(n!=null) &#123;</span><br><span class="line">            n.val = value;</span><br><span class="line">            map.put(key, n);</span><br><span class="line">            n.pre.next = n.next;</span><br><span class="line">            n.next.pre = n.pre;</span><br><span class="line">            appendTail(n);</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        // else &#123;</span><br><span class="line">        if(map.size() == cap) &#123;</span><br><span class="line">            Node tmp = head.next;</span><br><span class="line">            head.next = head.next.next;</span><br><span class="line">            head.next.pre = head;</span><br><span class="line">            map.remove(tmp.key);</span><br><span class="line">        &#125;</span><br><span class="line">        n = new Node(key, value);</span><br><span class="line">        // youngest node append taill</span><br><span class="line">        appendTail(n);</span><br><span class="line">        map.put(key, n);</span><br><span class="line">    &#125;</span><br><span class="line">    private void appendTail(Node n) &#123;</span><br><span class="line">        n.next = tail;</span><br><span class="line">        n.pre = tail.pre;</span><br><span class="line">        tail.pre.next = n;</span><br><span class="line">        tail.pre = n;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public class LRUCache &#123;</span><br><span class="line">    private int capacity;</span><br><span class="line">    private Map&lt;Integer, Integer&gt; cache;</span><br><span class="line">    public LRUCache(int capacity) &#123;</span><br><span class="line">        this.capacity = capacity;</span><br><span class="line">        this.cache = new java.util.LinkedHashMap&lt;Integer, Integer&gt; (capacity, 0.75f, true) &#123;</span><br><span class="line">            // 定义put后的移除规则，大于容量就删除eldest</span><br><span class="line">            protected boolean removeEldestEntry(Map.Entry&lt;Integer, Integer&gt; eldest) &#123;</span><br><span class="line">                return size() &gt; capacity;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    public int get(int key) &#123;</span><br><span class="line">        if (cache.containsKey(key)) &#123;</span><br><span class="line">            return cache.get(key);</span><br><span class="line">        &#125; else</span><br><span class="line">            return -1;</span><br><span class="line">    &#125;</span><br><span class="line">    public void set(int key, int value) &#123;</span><br><span class="line">        cache.put(key, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/04/16/memcache/" data-id="cjh5rqymn0000t4ulgqmfuds6" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-redis" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/12/redis/" class="article-date">
  <time datetime="2018-04-12T02:28:28.000Z" itemprop="datePublished">2018-04-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/12/redis/">redis</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><h2 id="基本数据类型"><a href="#基本数据类型" class="headerlink" title="基本数据类型"></a>基本数据类型</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">typedef struct redisObject &#123;  </span><br><span class="line">  </span><br><span class="line">    // 类型  </span><br><span class="line">    unsigned type:4;          </span><br><span class="line">  </span><br><span class="line">    // 不使用(对齐位)  </span><br><span class="line">    unsigned notused:2;  </span><br><span class="line">  </span><br><span class="line">    // 编码方式  </span><br><span class="line">    unsigned encoding:4;  </span><br><span class="line">  </span><br><span class="line">    // LRU 时间（相对于 server.lruclock）  </span><br><span class="line">    unsigned lru:22;  </span><br><span class="line">  </span><br><span class="line">    // 引用计数  </span><br><span class="line">    int refcount;  </span><br><span class="line">  </span><br><span class="line">    // 指向对象的值  </span><br><span class="line">    void *ptr;  </span><br><span class="line">  </span><br><span class="line">&#125; robj;</span><br></pre></td></tr></table></figure>
<h3 id="5种type"><a href="#5种type" class="headerlink" title="5种type"></a>5种type</h3><ul>
<li>String</li>
<li>List</li>
<li>Set</li>
<li>ZSet</li>
<li>Hash</li>
</ul>
<h3 id="8种encoding"><a href="#8种encoding" class="headerlink" title="8种encoding"></a>8种encoding</h3><ul>
<li>REDIS_ENCODING_INT</li>
<li>REDIS_ENCODING_EMBSTR</li>
<li>REDIS_ENCODING_RAW</li>
<li>REDIS_ENCODING_HT</li>
<li>REDIS_ENCODING_LINKEDLIST</li>
<li>REDIS_ENCODING_ZIPLIST</li>
<li>REDIS_ENCODING_INTSET</li>
<li>REDIS_ENCODING_SKIPLIST  </li>
</ul>
<p>###实现</p>
<ol>
<li>字符串对应的int embstr raw，字符串能转成long，就对应int；字符串长度小于39字节，用embstr，否则raw</li>
<li>列表对应ziplist或者linkedlist</li>
<li>哈希对应ziplist或者ht（ht由dict结构实现）</li>
<li>集合对应iniset或者ht，iniset支持三种长度：int16 int32 int64，所以会涉及升级操作，但不支持降级</li>
<li>有序集合对应ziplist或者skiplist+dict</li>
</ol>
<h2 id="Pub-Sub"><a href="#Pub-Sub" class="headerlink" title="Pub/Sub"></a>Pub/Sub</h2><pre><code>发布/订阅模式，可用来实现队列
</code></pre><h2 id="LRU策略"><a href="#LRU策略" class="headerlink" title="LRU策略"></a>LRU策略</h2><ol>
<li>volatile-random</li>
<li>volatile-lru</li>
<li>volatile-ttl</li>
<li>allkeys-lru</li>
<li>allkeys-random</li>
<li>noeviction</li>
</ol>
<h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2><h3 id="相关命令"><a href="#相关命令" class="headerlink" title="相关命令"></a>相关命令</h3><ul>
<li>WATCH</li>
<li>UNWATCH</li>
<li>MULTI</li>
<li>EXEC</li>
<li>DISCARD</li>
</ul>
<h3 id="使用逻辑"><a href="#使用逻辑" class="headerlink" title="使用逻辑"></a>使用逻辑</h3><ul>
<li>执行MULTI命令，后续的所有命令都放入到一个队列中，执行EXEC，队列中的命令执行，执行DISCARD，队列清空，事务结束</li>
<li>WATCH命令监视某些键之后，执行上述事务流程，如果在执行EXEC之前，有任何一个被监视的键的内容被修改了，则整个事务取消</li>
<li>EXEC执行成功与否，所有键上的监视都会取消</li>
<li>UNWATCH取消监视</li>
</ul>
<h2 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h2><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><ol>
<li>从服务器连接时，发送SYNC命令给主服务器</li>
<li>主服务器接到命令后，执行BGSAVE命令，然后开启一个子进程，把数据保存到磁盘中，生成.rdb文件；主进程还继续接受新的写入命令，并将新命令保存到缓冲区</li>
<li>主服务器将.rdb文件发送给从服务器，从服务器读取内容载入到内存中</li>
<li>之后主服务器会以 Redis 命令协议的格式， 将写命令缓冲区中积累的所有内容都发送给从服务器</li>
<li>数据同步完成</li>
</ol>
<h3 id="开启从服务器"><a href="#开启从服务器" class="headerlink" title="开启从服务器"></a>开启从服务器</h3><pre><code>slaveof 主服务器ip 主服务器port
</code></pre><h2 id="持久化"><a href="#持久化" class="headerlink" title="持久化"></a>持久化</h2><h3 id="RDB"><a href="#RDB" class="headerlink" title="RDB"></a>RDB</h3><h4 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h4><ul>
<li>满足某一条件时，保存一次数据集。如save 60 1000，60秒内至少有1000个改动，则执行一次</li>
<li>调用save或者bgsave命令，也会执行保存<h4 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h4></li>
<li>文件紧凑；适合数据备份和灾难恢复；</li>
<li>数据恢复速度比AOF快；</li>
<li>只需要fork子进程，主进程可以继续处理命令；<h4 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h4></li>
<li>有可能丢失数据，因为RDB操作并不轻松，所以一般至少5分钟才保存一次，如果宕机，这几分钟的数据就丢失了；</li>
<li>当数据量很大时，fork出的子进程会比较耗时，有可能造成短暂的服务中断（xx毫秒-1秒）</li>
</ul>
<h3 id="AOF"><a href="#AOF" class="headerlink" title="AOF"></a>AOF</h3><h4 id="原理-2"><a href="#原理-2" class="headerlink" title="原理"></a>原理</h4><ul>
<li>配置文件开启：appendonly yes</li>
<li>调用BGREWRITEAOF进行重写，缩小文件体积</li>
<li>可使用redis-check-aof –fix来修复损坏的AOF文件，否则无法正常启动redis<h4 id="优点-1"><a href="#优点-1" class="headerlink" title="优点"></a>优点</h4></li>
<li>默认每秒执行一次fsync，这样即使宕机也只是丢失一秒的数据（fsync策略可自行配置，不执行、每秒执行、每次写入时执行）</li>
<li>文件过大时，自动在后台进行AOF重写，缩小到最小命令集合</li>
<li>AOF文件只追加<h4 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a>缺点</h4></li>
<li>通常体积大于RDB</li>
<li>fsync策略不同，AOF速度有可能会慢于RDB</li>
</ul>
<h3 id="选择策略"><a href="#选择策略" class="headerlink" title="选择策略"></a>选择策略</h3><ul>
<li>如果想达到MySQL、pgsql的数据安全性，可同时使用两种</li>
<li>如果可以承受几分钟内的数据丢失，则使用RDB</li>
<li>不推荐只使用AOF，因为RDB很适合于数据恢复，且恢复速度快于AOF</li>
</ul>
<h2 id="哨兵Sentinel"><a href="#哨兵Sentinel" class="headerlink" title="哨兵Sentinel"></a>哨兵Sentinel</h2><h3 id="职责（保证高可用）"><a href="#职责（保证高可用）" class="headerlink" title="职责（保证高可用）"></a>职责（保证高可用）</h3><ol>
<li>监控：主从服务器是否正常</li>
<li>通知：服务器出问题时候，通过API通知管理员或其他应用程序</li>
<li>自动故障转移：主观下线、客观下线、选举新主服务器、通知其他从服务器</li>
</ol>
<h2 id="集群Cluster"><a href="#集群Cluster" class="headerlink" title="集群Cluster"></a>集群Cluster</h2><blockquote>
<p>Redis集群使用分片来实现数据共享，一个集群包含16384个哈希槽（slot），集群中的不同主节点，分别维护其中的一部分槽位，通过CRC16(key) % 16384计算出key属于哪个槽位，然后存入。<br>比如有三个主节点A、B、C，节点A存储0-5500槽位，B存储5501-11000，C存储11001-16384<br>通常每个主节点包含1到多个从节点，以保证整个集群的高可用，否则某个主节点下线，整个集群都会挂掉</p>
</blockquote>
<h3 id="重新分片"><a href="#重新分片" class="headerlink" title="重新分片"></a>重新分片</h3><blockquote>
<p>reshard，将现有的槽位挪出一部分到新的节点，可从某个节点挪出，也可从所有节点挪出</p>
</blockquote>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><ol>
<li>如果槽位存满了怎么办 LRU？</li>
<li>如果出现哈希碰撞怎么处理的</li>
</ol>
<h2 id="未完待续……"><a href="#未完待续……" class="headerlink" title="未完待续……"></a>未完待续……</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/04/12/redis/" data-id="cjh5rqynk0004t4ul4sx941kh" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-高级排序" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/11/高级排序/" class="article-date">
  <time datetime="2018-04-11T05:58:28.000Z" itemprop="datePublished">2018-04-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/11/高级排序/">高级排序</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="希尔排序"><a href="#希尔排序" class="headerlink" title="希尔排序"></a>希尔排序</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">package me.woodknot;</span><br><span class="line"></span><br><span class="line">public class ShellSort &#123;</span><br><span class="line"></span><br><span class="line">	public static void sort(long[] arr) &#123;</span><br><span class="line">		int h = 1;</span><br><span class="line"></span><br><span class="line">		while (h &lt; arr.length / 3) &#123;</span><br><span class="line">			h = h * 3 + 1;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		while (h &gt; 0) &#123;</span><br><span class="line">			long tmp = 0;</span><br><span class="line">			for (int i = h; i &lt; arr.length; i++) &#123;</span><br><span class="line">				tmp = arr[i];</span><br><span class="line">				int j = i;</span><br><span class="line">				while (j &gt; h - 1 &amp;&amp; arr[j - h] &gt;= tmp) &#123;</span><br><span class="line">					arr[j] = arr[j - h];</span><br><span class="line">					j -= h;</span><br><span class="line">				&#125;</span><br><span class="line">				arr[j] = tmp;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">			h = (h - 1) / 3;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="快速排序"><a href="#快速排序" class="headerlink" title="快速排序"></a>快速排序</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">package me.woodknot;</span><br><span class="line"></span><br><span class="line">public class QuickSort &#123;</span><br><span class="line">	</span><br><span class="line">	public static void quickSort(int[] arr) &#123;</span><br><span class="line">		qsort(arr, 0, arr.length - 1);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private static void qsort(int[] arr, int low, int high) &#123;</span><br><span class="line">		if (low &lt; high) &#123;</span><br><span class="line">			int pivot = partition(arr, low, high); // 将数组分为两部分</span><br><span class="line">			qsort(arr, low, pivot - 1); // 递归排序左子数组</span><br><span class="line">			qsort(arr, pivot + 1, high); // 递归排序右子数组</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private static int partition(int[] arr, int low, int high) &#123;</span><br><span class="line">		int pivot = arr[low]; // 枢轴记录</span><br><span class="line">		while (low &lt; high) &#123;</span><br><span class="line">			while (low &lt; high &amp;&amp; arr[high] &gt;= pivot)</span><br><span class="line">				--high;</span><br><span class="line">			arr[low] = arr[high]; // 交换比枢轴小的记录到左端</span><br><span class="line">			while (low &lt; high &amp;&amp; arr[low] &lt;= pivot)</span><br><span class="line">				++low;</span><br><span class="line">			arr[high] = arr[low]; // 交换比枢轴小的记录到右端</span><br><span class="line">		&#125;</span><br><span class="line">		// 扫描完成，枢轴到位</span><br><span class="line">		arr[low] = pivot;</span><br><span class="line">		// 返回的是枢轴的位置</span><br><span class="line">		return low;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		int[] arr = new int[] &#123; 34, 23, 2, 1, -5, 11,2,  45, 33, 99, 213 &#125;;</span><br><span class="line"></span><br><span class="line">		for (long num : arr) &#123;</span><br><span class="line">			System.out.print(num + &quot; &quot;);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		System.out.println();</span><br><span class="line"></span><br><span class="line">		QuickSort.quickSort(arr);</span><br><span class="line"></span><br><span class="line">		for (long num : arr) &#123;</span><br><span class="line">			System.out.print(num + &quot; &quot;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/04/11/高级排序/" data-id="cjh5rqynw000et4uly5rld3qr" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-简单排序" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/11/简单排序/" class="article-date">
  <time datetime="2018-04-11T05:58:24.000Z" itemprop="datePublished">2018-04-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/11/简单排序/">简单排序</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://images0.cnblogs.com/blog/512692/201304/12095757-775cf861406644bfad60ff2763f499e4.png" alt="时间复杂度"></p>
<h1 id="冒泡排序"><a href="#冒泡排序" class="headerlink" title="冒泡排序"></a>冒泡排序</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">package me.woodknot;</span><br><span class="line"></span><br><span class="line">public class BubbleSort &#123;</span><br><span class="line"></span><br><span class="line">	public static void sort(long[] arr) &#123;</span><br><span class="line">		long tmp = 0;</span><br><span class="line">		for (int i = 0; i &lt; arr.length - 1; i++) &#123;</span><br><span class="line">			for (int j = arr.length - 1; j &gt; 0; j--) &#123;</span><br><span class="line">				if (arr[j] &lt; arr[j - 1]) &#123;</span><br><span class="line">					tmp = arr[j];</span><br><span class="line">					arr[j] = arr[j - 1];</span><br><span class="line">					arr[j - 1] = tmp;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		long[] arr = new long[] &#123; 34, 23, 2, 1, -5 &#125;;</span><br><span class="line"></span><br><span class="line">		for (long num : arr) &#123;</span><br><span class="line">			System.out.print(num + &quot; &quot;);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		System.out.println();</span><br><span class="line"></span><br><span class="line">		BubbleSort.sort(arr);</span><br><span class="line"></span><br><span class="line">		for (long num : arr) &#123;</span><br><span class="line">			System.out.print(num + &quot; &quot;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="选择排序"><a href="#选择排序" class="headerlink" title="选择排序"></a>选择排序</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">package me.woodknot;</span><br><span class="line"></span><br><span class="line">public class SelectionSort &#123;</span><br><span class="line"></span><br><span class="line">	public static void sort(long[] arr) &#123;</span><br><span class="line">		long tmp = 0;</span><br><span class="line">		int k = 0;</span><br><span class="line">		for (int i = 0; i &lt; arr.length - 1; i++) &#123;</span><br><span class="line">			k = i;</span><br><span class="line">			for (int j = i; j &lt; arr.length; j++) &#123;</span><br><span class="line">				if (arr[j] &lt; arr[k]) &#123;</span><br><span class="line">					k = j;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			tmp = arr[i];</span><br><span class="line">			arr[i] = arr[k];</span><br><span class="line">			arr[k] = tmp;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		long[] arr = new long[]&#123;34, 23, 2, 1, -5&#125;;</span><br><span class="line">		</span><br><span class="line">		for(long num : arr) &#123;</span><br><span class="line">			System.out.print(num + &quot; &quot;);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		System.out.println();</span><br><span class="line">		</span><br><span class="line">		SelectionSort.sort(arr);</span><br><span class="line">		</span><br><span class="line">		for(long num : arr) &#123;</span><br><span class="line">			System.out.print(num + &quot; &quot;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="插入排序"><a href="#插入排序" class="headerlink" title="插入排序"></a>插入排序</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">package me.woodknot;</span><br><span class="line"></span><br><span class="line">public class InsertSort &#123;</span><br><span class="line"></span><br><span class="line">	public static void sort(long[] arr) &#123;</span><br><span class="line">		long tmp = 0;</span><br><span class="line">		for (int i = 1; i &lt; arr.length; i++) &#123;</span><br><span class="line">			tmp = arr[i];</span><br><span class="line">			int j = i;</span><br><span class="line">			while (j &gt; 0 &amp;&amp; arr[j] &gt;= tmp) &#123;</span><br><span class="line">				arr[j] = arr[j - 1];</span><br><span class="line">				j--;</span><br><span class="line">			&#125;</span><br><span class="line">			arr[j] = tmp;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		long[] arr = new long[] &#123; 34, 23, 2, 51, -5 &#125;;</span><br><span class="line"></span><br><span class="line">		for (long num : arr) &#123;</span><br><span class="line">			System.out.print(num + &quot; &quot;);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		System.out.println();</span><br><span class="line"></span><br><span class="line">		SelectionSort.sort(arr);</span><br><span class="line"></span><br><span class="line">		for (long num : arr) &#123;</span><br><span class="line">			System.out.print(num + &quot; &quot;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/04/11/简单排序/" data-id="cjh5rqynq000at4ulp130uomm" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-记一次数据库问题排查" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/10/记一次数据库问题排查/" class="article-date">
  <time datetime="2018-04-10T08:39:25.000Z" itemprop="datePublished">2018-04-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/10/记一次数据库问题排查/">记一次数据库问题排查</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="背景介绍"><a href="#背景介绍" class="headerlink" title="背景介绍"></a>背景介绍</h2><blockquote>
<p>近期公司在进行数据库整合及迁移的工作，以主从+MHA的方案搭建了高可用集群，MySQL版本号是5.7.21<br>昨天晚上把各个项目的业务数据迁移到了新环境中，今天早上一个项目的同事找过来</p>
</blockquote>
<h2 id="问题描述（客户端工具用的是Navicat）"><a href="#问题描述（客户端工具用的是Navicat）" class="headerlink" title="问题描述（客户端工具用的是Navicat）"></a>问题描述（客户端工具用的是Navicat）</h2><ol>
<li>执行一条insert语句后，显示执行成功，但是打开表发现没有任何数据</li>
<li>如果图形化插入一条数据，刷新页面数据存在，但是关闭库再打开发现数据又没了。</li>
<li>如果图形化插入一条数据，马上再删除这条数据，会报锁表的错误（Lock table ….  retrying transaction，具体报错记不清了）</li>
<li><p>在命令行模式下执行insert语句会立即生效，select即可看到插入的数据</p>
<p> 发现两个关键词：锁表、事务</p>
</li>
</ol>
<h2 id="排查问题"><a href="#排查问题" class="headerlink" title="排查问题"></a>排查问题</h2><blockquote>
<p>show status  like ‘Table%’</p>
<blockquote>
<p>Table_locks_immediate  指的是能够立即获得表级锁的次数<br>Table_locks_waited  指的是不能立即获取表级锁而需要等待的次数</p>
</blockquote>
</blockquote>
<blockquote>
<p>show OPEN TABLES where In_use &gt; 0; （查看正在被锁定的的表）</p>
<blockquote>
<p>Empty set;</p>
</blockquote>
</blockquote>
<blockquote>
<p>其他相关命令：</p>
<blockquote>
<p>show engine innodb status;<br>show processlist;<br>show status like ‘%lock%’<br>SELECT <em> FROM INFORMATION_SCHEMA.INNODB_LOCKS;  （查看正在锁的事务）<br>SELECT </em> FROM INFORMATION_SCHEMA.INNODB_LOCK_WAITS;  （查看等待锁的事务）</p>
</blockquote>
</blockquote>
<blockquote>
<p>一顿查之后发现并没有表锁住，改变思路，查看事务相关问题<br>在执行完一条insert之后，执行了一条commit语句，发现可以看到数据了；<br>然后执行delete语句，发现没有删除，由于手抖，又执行了delete+commit，锁表了<br>表解锁之后，直接执行delete+commit，数据消失<br>由此猜测是事务自动提交被关闭了，查看一下：</p>
<blockquote>
<p>show variables like ‘autocommit’<br>果然是OFF<br>由于我这边无法直接修改配置文件，先手动改了一下:<br>set session autocommit=on<br>set global autocommit=on<br>问题消失~<br>但是以上修改的方法，重启MySQL之后会消失，联系了运维人员直接修改配置文件。</p>
</blockquote>
</blockquote>
<p><strong>完结撒花</strong></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/04/10/记一次数据库问题排查/" data-id="cjh5rqyns000bt4ul5cmv6gs9" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-数据结构-哈希表" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/10/数据结构-哈希表/" class="article-date">
  <time datetime="2018-04-10T08:37:35.000Z" itemprop="datePublished">2018-04-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/10/数据结构-哈希表/">数据结构-哈希表</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="哈希表"><a href="#哈希表" class="headerlink" title="哈希表"></a>哈希表</h1><h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><pre><code>不像数组只能存放同一类型的数据，哈希表中可以存放任何类型的数据。
关键：对键值进行哈希化，需要自己设计hashCode函数
</code></pre><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><pre><code>哈希碰撞：不同的键值哈希化之后的值相同，即它们要放入同一个bucket中
</code></pre><h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><pre><code>开放地址法：当哈希值的位置上已经有了数据时，继续查找下一个空位，将数据放入（该方法的缺点是会占用其他正常值的位置）
链地址法：以链表的形式存储碰撞后的值
</code></pre>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/04/10/数据结构-哈希表/" data-id="cjh5rqynn0007t4ul7bkz7lao" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-数据结构-二叉搜索树" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/10/数据结构-二叉搜索树/" class="article-date">
  <time datetime="2018-04-10T08:11:56.000Z" itemprop="datePublished">2018-04-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/10/数据结构-二叉搜索树/">数据结构-二叉搜索树</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="搜索二叉树"><a href="#搜索二叉树" class="headerlink" title="搜索二叉树"></a>搜索二叉树</h1><h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><pre><code>综合了数组和链表的优点，查找、插入和删除都很容易。
左子节点的值一定小于当前节点的值，右一定大于。
</code></pre><h2 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h2><pre><code>当插入的数据是有序数据时，树就变成了非平衡二叉树，此时的树就变成了链表，效率急剧下降，为了解决此问题，设计出了红黑树
</code></pre><h2 id="基础操作"><a href="#基础操作" class="headerlink" title="基础操作"></a>基础操作</h2><pre><code>insert、find、delete
广度优先遍历
深度优先遍历
    先序：父、左、右
    中序：左、父、右
    后序：左、右、父
</code></pre><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line">package me.woodknot;</span><br><span class="line"></span><br><span class="line">class TreeNode &#123;</span><br><span class="line">	public int data;</span><br><span class="line">	public TreeNode left;</span><br><span class="line">	public TreeNode right;</span><br><span class="line">	</span><br><span class="line">	public TreeNode(int value) &#123;</span><br><span class="line">		this.data = value;</span><br><span class="line">		this.left = null;</span><br><span class="line">		this.right = null;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class BinaryTree &#123;</span><br><span class="line">	</span><br><span class="line">	private TreeNode root;</span><br><span class="line">	</span><br><span class="line">	public void insert(int value) &#123;</span><br><span class="line">		TreeNode tn = new TreeNode(value);</span><br><span class="line">		</span><br><span class="line">		if(root == null) &#123;</span><br><span class="line">			root = tn;</span><br><span class="line">			return;</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			_doInsert(root, tn);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	private void _doInsert(TreeNode node, TreeNode tn) &#123;</span><br><span class="line">		if(node.data &gt; tn.data) &#123;</span><br><span class="line">			if(node.left == null) &#123;</span><br><span class="line">				node.left = tn;</span><br><span class="line">			&#125; else &#123;</span><br><span class="line">				_doInsert(node.left, tn);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			if(node.right == null) &#123;</span><br><span class="line">				node.right = tn;</span><br><span class="line">			&#125; else &#123;</span><br><span class="line">				_doInsert(node.right, tn);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public TreeNode find(int value) &#123;</span><br><span class="line">		TreeNode current = root;</span><br><span class="line">		while(current.data != value) &#123;</span><br><span class="line">			if(current.data &lt; value) &#123;</span><br><span class="line">				current = current.right;</span><br><span class="line">			&#125; else &#123;</span><br><span class="line">				current = current.left;</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			if(current == null) &#123;</span><br><span class="line">				return null;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		return current;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public void preOrder(TreeNode node) &#123;</span><br><span class="line">		System.out.println(node.data);</span><br><span class="line">		</span><br><span class="line">		if(node.left != null) &#123;</span><br><span class="line">			preOrder(node.left);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		if(node.right != null) &#123;</span><br><span class="line">			preOrder(node.right);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public void midOrder(TreeNode node) &#123;</span><br><span class="line">		if(node.left != null) &#123;</span><br><span class="line">			midOrder(node.left);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		System.out.println(node.data);</span><br><span class="line">		</span><br><span class="line">		if(node.right != null) &#123;</span><br><span class="line">			midOrder(node.right);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public void sufOrder(TreeNode node) &#123;</span><br><span class="line">		if(node.left != null) &#123;</span><br><span class="line">			sufOrder(node.left);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		if(node.right != null) &#123;</span><br><span class="line">			sufOrder(node.right);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		System.out.println(node.data);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	//借助队列实现</span><br><span class="line">	public void bfs() &#123;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public TreeNode delete(int value) &#123;</span><br><span class="line">		return _doDelete(root, value);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	private TreeNode _doDelete(TreeNode node, int value) &#123;</span><br><span class="line">		if(node == null) &#123;</span><br><span class="line">			return null;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		if(value &lt; node.data) &#123;</span><br><span class="line">			node.left = _doDelete(node.left, value);</span><br><span class="line">			return node;</span><br><span class="line">		&#125; else if (value &gt; node.data) &#123;</span><br><span class="line">			node.right = _doDelete(node.right, value);</span><br><span class="line">			return node;</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			if(node.left == null &amp;&amp; node.right == null) &#123;</span><br><span class="line">				node = null;</span><br><span class="line">				return node;</span><br><span class="line">			&#125; </span><br><span class="line">			if (node.left == null) &#123;</span><br><span class="line">				node = node.right;</span><br><span class="line">				return node;</span><br><span class="line">			&#125; else if(node.right == null) &#123;</span><br><span class="line">				node = node.left;</span><br><span class="line">				return node;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		return node;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		BinaryTree bt = new BinaryTree();</span><br><span class="line">		bt.insert(10);</span><br><span class="line">		bt.insert(12);</span><br><span class="line">		bt.insert(20);</span><br><span class="line">		bt.insert(5);</span><br><span class="line">		</span><br><span class="line">//		bt.midOrder(bt.root);</span><br><span class="line">		TreeNode d = bt.delete(6);</span><br><span class="line">		System.out.println(d.data);</span><br><span class="line">//		bt.midOrder(bt.root);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/04/10/数据结构-二叉搜索树/" data-id="cjh5rqynm0006t4ulaorpyc9k" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-数据结构-栈" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/04/10/数据结构-栈/" class="article-date">
  <time datetime="2018-04-10T08:11:49.000Z" itemprop="datePublished">2018-04-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/04/10/数据结构-栈/">数据结构-栈</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="栈"><a href="#栈" class="headerlink" title="栈"></a>栈</h1><h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><pre><code>后进先出，可基于数组或者链表实现
</code></pre><h2 id="基础操作"><a href="#基础操作" class="headerlink" title="基础操作"></a>基础操作</h2><pre><code>push、pop、peek、isEmpty、size、resize
</code></pre><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">package me.woodknot;</span><br><span class="line"></span><br><span class="line">import java.util.Arrays;</span><br><span class="line">import java.util.NoSuchElementException;</span><br><span class="line"></span><br><span class="line">public class Stack&lt;E&gt; &#123;</span><br><span class="line"></span><br><span class="line">	private E[] arr;</span><br><span class="line">	private int n;</span><br><span class="line">	</span><br><span class="line">	public Stack() &#123;</span><br><span class="line">		arr = (E[]) new Object[2];</span><br><span class="line">		n = 0;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public boolean isEmpty() &#123;</span><br><span class="line">		return n == 0;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public int size() &#123;</span><br><span class="line">		return n;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public void resize(int capacity) &#123;</span><br><span class="line">		arr = Arrays.copyOf(arr, capacity);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public void push(E elem) &#123;</span><br><span class="line">		if(n == arr.length) &#123;</span><br><span class="line">			resize(2 * n);</span><br><span class="line">		&#125;</span><br><span class="line">		arr[n++] = elem;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public E pop() &#123;</span><br><span class="line">		if(isEmpty()) &#123;</span><br><span class="line">			throw new NoSuchElementException(&quot;empty stack&quot;);</span><br><span class="line">		&#125;</span><br><span class="line">		E top = arr[n - 1];</span><br><span class="line">		arr[n - 1] = null;</span><br><span class="line">		n--;</span><br><span class="line">		</span><br><span class="line">		return top;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public E peek() &#123;</span><br><span class="line">		return arr[n - 1];</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public void print() &#123;</span><br><span class="line">		for(int i = 0; i &lt; n; i ++) &#123;</span><br><span class="line">			System.out.println(arr[i]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	public static void main(String[] args) &#123;</span><br><span class="line">		Stack&lt;String&gt; ms = new Stack&lt;String&gt;();</span><br><span class="line">		ms.push(&quot;php&quot;);</span><br><span class="line">		ms.push(&quot;python&quot;);</span><br><span class="line">		ms.push(&quot;java&quot;);</span><br><span class="line">		String f = ms.peek();</span><br><span class="line">//		System.out.println(f);</span><br><span class="line">		ms.print();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/04/10/数据结构-栈/" data-id="cjh5rqyno0008t4ulifa4xvr1" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/04/26/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2018/04/17/nginx-php-fpm/">nginx php-fpm</a>
          </li>
        
          <li>
            <a href="/2018/04/16/memcache/">memcache</a>
          </li>
        
          <li>
            <a href="/2018/04/12/redis/">redis</a>
          </li>
        
          <li>
            <a href="/2018/04/11/高级排序/">高级排序</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>